# Выбор и настройка мониторинга в системе

## Анализ узлов системы для организации мониторинга:
Перед организацией мониторинга необходимо проанализировать потенциальные проблемы компонентов и их взаимосвязей. Исходя из полученных данных, мы примем решении об организации мониторинга только для необходимых узлов и взаимосвязей. В установке мониторинга всего нет необходимости, так как это потребует привлечение дополнительных сотрудников и отрицательно скажется на производительности системы (мониторинг потребляет ресурсы). 
Так как система находится в одном облаке, можем предположить, что проблем взаимосвязи между компонентами и базами данных нет. Связь через MQ то же не должна доставлять проблем, так как между MES и CRM не проходят болящие объемы данных, только отслеживаются статусы заказов. 
Но проблемы могут возникать при связи внешних систем с внутренними. Считаю что для их отслеживания необходимо установить мониторинг взаимосвязей внешних и внутренних модулей системы.
 Система состоит из трёх приложений: Онлайн-магазин, CRM, MES. 
 На мой взгляд, проблемы с производительностью в Онлайн магазине быть не должно, так как этот модуль только получает заказы и передает в хранилище файлов. Количество клиентов, загружающих онлайн-модели и планируемый их рост не способны обвалить сайт огромным количеством запросов исходя из специфики бизнеса.
Проблем с CRM то же не должно быть, так как она только получает заказы и передает в хранилище файлов. Количество заказов не запредельное, исходя из специфики бизнеса.
Приложение МЕS может вызывать проблемы, так как в нем происчходит расчет стоимости заказа на основе числа полигонов, который может длится до 30 минут на заказ, из за которого может возникать повышенная загрузка приложения, из-за которого оно не успевает своевременно заканчивать расчет. Считаю, что тут необходимо установить мониторинг.

## Выбор подхода к мониторингу:
Считаю, что необходимо использовать следующие подходы:
1. Для мониторинга внешних API больше подойдет "Четыре золотых сигнала"
2. Для мониторинга расчета стоимости заказа лучше подходит USE 


## Список метрик для отслеживания:
1. Для мониторинга работы внешних API(Четыре золотых сигнала):
Number of requests (RPS) for MES API -  показатель позволит отслеживать "Трафик"
Response time (latency) for MES API - показатель позволяющий отслеживать "Задержку"
Number of HTTP 500 for MES API -  показатель позволяющий отслеживать "Ошибки"
Количество успешных запросов к MES API - показатель позволит отслеживать "Насыщенность"
2. Для мониторинга расчетов стоимости заказов (USE).
CPU % for MES API - показатель позволяет отследить "Утилизацию"
Memory Utilisation for MES API - показатель позволяет отследить "Утилизацию"
Количество не рассчитанных заказов для MES API - показатель позволяет отследить "Насыщенность"
Количество ошибок при расчете заказов для MES API - показатель позволяет отследить "Ошибки"

## План действий:
1. Для организации мониторинга мы подключим к компоненту MES API систему сбора данных Prometeus и прописываем в коде метрики описанные в предыдущем пункте.
2. Устанавливаем Grafana для визуализации полученных данных. 
3. Связываем Grafana с Prometeus и получаем результаты по нашим метрикам

## Показатели насыщенности:
Для MES API показатели насыщенности "Количество успешных запросов к MES API" позволяет понять как проходит передача данных и на сколько она успешна. В случае если количество успешных запросов стремится к нулю, необходимо, перезагрузить сервис, если не поможет подключить DevOps-инженера для сбора других метрик и анализа данных. В случае ошибки после установки обновлений, откатится к предыдущей версии.
Рекомендуется в дальнейшем в этом месте использовать паттерна Circuit Breaker.

## Для мониторинга расчетов:
Для мониторинга показателей насыщенности используется метрика "Количество не рассчитанных заказов для MES API". Определяется как количество заказов загруженных в хранилище через Shop API и CRM API, но по которым не была рассчитана стоимость. В случае, если таких заказов больше чем 2, информировать DevOps-инженера. В будущем, в случае, если таких заказов больше чем 2, необходимо автоматически создавать дополнительные копии сервисов расчетов, работающие в параллель, для скорейшего решения проблем в этом узком месте. Предлагаю для этих целей использовать Kubernatis

